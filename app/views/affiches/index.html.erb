<div class="content_wrapper">
  <%= render :partial => 'filters' %>
  <div class="affiches_list">
    <div class="list_settings">
      <div class="presentation">
        <p>Настройка списка:</p>
        <ul>
          <li>
            <%= link_to 'список',
              affiches_path(@showings_presenter.query.merge(view: 'list')),
              { title: 'подробный список', data: 'list' }.merge(@showings_presenter.view_list? ? { class: 'list selected' } : { class: 'list' }) %>
          </li>
          <li>
            <%= link_to 'постеры',
              affiches_path(@showings_presenter.query.merge(view: 'posters')),
              { title: 'краткий список', data: 'posters' }.merge(@showings_presenter.view_list? ? { class: 'posters' } : { class: 'posters selected' }) %>
          </li>
        </ul>
      </div>
      <div class="sort affiches">
        <p>Сортировка:</p>
        <ul>
          <li>
              <%= link_to t('affiche.sort.popularity'),
              affiches_path(@showings_presenter.query.merge('order_by' => 'popularity')),
              { data: 'popularity' }.merge(@showings_presenter.sort_by_popularity? ? { class: 'selected' } : {}) %>
          </li>
          <li>
              <%= link_to t('affiche.sort.creation'),
              affiches_path(@showings_presenter.query.merge('order_by' => 'creation')),
              { data: 'creation' }.merge(@showings_presenter.sort_by_creation? ? { class: 'selected' } : {}) %>
          </li>
          <li>
              <%= link_to t('affiche.sort.nearness'),
              affiches_path(@showings_presenter.query.merge('order_by' => 'nearness')),
              { data: 'nearness' }.merge({}.tap { |h|
                                                  h['class'] = @showings_presenter.sort_by_nearness? ? 'selected' : '';
                                                  h['class'] += ' disabled' unless @showings_presenter.geo_filter.used? }
                                        ) %>
          </li>
        </ul>
      </div>
    </div>

    <% if @showings_presenter.collection.any? %>
      <ul class="items_list <%= @showings_presenter.view %>">
        <%= render :partial => @showings_presenter.partial %>
      </ul>
    <% else %>
      <p class="empty_items_list">По заданным параметрам ничего не найдено ;(</p>
    <% end %>
  </div>
</div>

<%= paginate @showings_presenter.paginated_collection %>
